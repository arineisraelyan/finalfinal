---
title: "robin"
execute:
    echo: false
    message: false
---

```{r}
#| message: false
library(tidytext)
library(dplyr)
library(stringr)
library(readr)
library(tidyr)
```
```{r}
#| message: false
dirt_robin <-  "~/Desktop/finalfinal/data/robin.txt"
```

```{r}
#| message: false
afinn <- get_sentiments("afinn")

positive <- get_sentiments("afinn") |> filter(value > 0)

negative <- get_sentiments("afinn") |> filter(value < 0)

lines_robin <- read_lines(dirt_robin) 
dir_robin <- tibble(text = lines_robin)
```

```{r}
#| message: false
tidy_book_robin <- dir_robin %>%
  mutate(
    linenumber = row_number(),
    chapter = cumsum(str_detect(text, regex("^chapter [ivxlc]+", ignore_case = TRUE)))
  ) %>%
  unnest_tokens(word, text) %>%
  filter(chapter > 0)
```

```{r}
#| message: false
sentiments_pos_robin <- tidy_book_robin %>%
  inner_join(positive) %>%
  count(word, sort = TRUE)

sentiments_neg_robin <- tidy_book_robin %>%
  inner_join(negative) %>%
  count(word, sort = TRUE)

word_scores_robin <- tidy_book_robin %>%
  count(word, sort = TRUE)

word_sentiment_data_robin <- word_scores_robin %>%
  left_join(get_sentiments("afinn"), by = "word") %>%
  mutate(word_avg_sent = n * value) %>%
  drop_na()
                                                     
```


```{r}
#| message: false
library(ggplot2)


word_sentiment_data_robin |> 
  ggplot(aes(word, word_avg_sent)) + 
  geom_col() + 
  scale_x_discrete(labels = NULL)
```

